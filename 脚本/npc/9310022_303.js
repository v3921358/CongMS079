var 红色箭头 = "#fUI/UIWindow/Quest/icon6/7#";
var 正方箭头 = "#fUI/Basic/BtHide3/mouseOver/0#";
var 点券图标 = "#fUI/CashShop/CashItem/0#";
var status = 0;
//普通奖池
var itemList1 = [
//[ID, 概率(1-100%), 数量, 是否喇叭(1为抽到该物品就广播,0抽到不广播)]

//紫金武器
[1022097, 3, 1,1],
[1302212, 3, 1,1],
[1302227, 1, 1,1],
[1312114, 3, 1,1],
[1312116, 1, 1,1],
[1322154, 3, 1,1],
[1322162, 1, 1,1],
[1332186, 3, 1,1],
[1332193, 1, 1,1],
[1372131, 3, 1,1],
[1372139, 1, 1,1],
[1382160, 3, 1,1],
[1382168, 1, 1,1],
[1402145, 3, 1, 1],
[1402151, 1, 1, 1],
[1412102, 3, 1, 1],
[1412104, 1, 1, 1],
[1422105, 3, 1, 1],
[1422107, 1, 1, 1],
[1432135, 3, 1, 1],
[1432138, 1, 1, 1],
[1442173, 3, 1, 1],
[1452165, 3, 1,1],
[1452170, 1, 1,1],
[1462156, 3, 1,1],
[1462159, 1, 1,1],
[1472177, 3, 1,1],
[1472179, 1, 1,1],
[1482138, 3, 1,1],
[1482140, 1, 1,1],
[1132151, 3, 1, 1],
[1132154, 1, 1, 1],
[1082430, 3, 1, 1],
[1082433, 1, 1, 1],
[1072660, 1, 1, 1],
[1072666, 1, 1, 1],
[1492138, 3, 1,1],
[1492152, 1, 1,1],
[1112742, 3, 1, 1],
[1112743, 1, 1, 1],

//装备系列
[1132127, 1, 1, 1],
[1132145, 1, 1, 1],
[1012319, 1, 1, 1],
[1402037, 1, 1,1],
[1382015, 20, 1,1],
[1382016, 1, 1,1],
[1092030, 2, 1, 1],
[1092045, 1, 1, 1],
[1092046, 10, 1, 1],
[1092047, 5, 1, 1],
[1452045, 10, 1, 1],
[1452100, 10, 1, 1],
[1302013, 25, 1, 1],
[1452025, 1, 1, 1],
[1462040, 20, 1, 1],
[1462085, 8, 1, 1],
[1082145, 10, 1, 1],
[1082146, 10, 1, 1],
[1082147, 10, 1, 1],
[1082148, 10, 1, 1],
[1082149, 3, 1, 1],//工地手套(褐)
[1082150, 10, 1, 1],
[1082175, 5, 1, 1],
[1082176, 5, 1, 1],
[1082177, 5, 1, 1],
[1082178, 5, 1, 1],
[1082179, 1, 1, 1],
[1102040, 5, 1, 1],
[1102041, 5, 1, 1],
[1102042, 5, 1, 1],
[1102043, 30, 1, 1],
[1102053, 30, 1, 1],
[1102055, 30, 1, 1],
[1102082, 3, 1, 1],
[1102084, 3, 1, 1],
[1102085, 3, 1, 1],
[1102086, 3, 1, 1],
[1102163, 1, 1, 1],
[1072157, 5, 1, 1],
[1072158, 5, 1, 1],
[1072159, 5, 1, 1],
[1072160, 5, 1, 1],
[1072872, 1, 1, 1],
[1072239, 3, 1, 1],
[1012321, 1, 1, 1],
[1012529, 1, 1, 1],
[1012504, 1, 1, 1],
[1012512, 5, 1, 1],
[1012011, 15, 1, 1],
[1012012, 15, 1, 1],
[1012013, 15, 1, 1],
[1012014, 15, 1, 1],
[1012015, 15, 1, 1],
[1012016, 15, 1, 1],
[1012017, 15, 1, 1],
[1012098, 15, 1, 1],
[1012101, 15, 1, 1],
[1012102, 15, 1, 1],
[1012103, 15, 1, 1],
[1012304, 15, 1, 1],
[1012305, 15, 1, 1],
[1012306, 15, 1, 1],
[1012328, 15, 1, 1],
[1012417, 5, 1, 1],
[1012418, 2, 1, 1],
[1012419, 2, 1, 1],
[1022129, 2, 1, 1],
[1022132, 2, 1, 1],
[1022134, 2, 1, 1],
[1022135, 5, 1, 1],
[1022160, 5, 1, 1],
[1022186, 5, 1, 1],
[1032032, 5, 1, 1],
[1032026, 5, 1, 1],
[1032098, 5, 1, 1],
[1032099, 1, 1, 1],
[1032174, 1, 1, 1],
[1122109, 5, 1, 1],
[1122119, 1, 1, 1],
[1132000, 15, 1, 1],//白色腰带
[1132001, 10, 1, 1],//黄色腰带
[1132002, 8, 1, 1],//蓝色腰带
[1132003, 5, 1, 1],//红色腰带
[1132004, 2, 1, 1],//黑贺腰带
[1012268, 25, 1, 1],
[1012267, 25, 1, 1],
[1022047, 25, 1, 1],
[1022058, 25, 1, 1],
[1022060, 25, 1, 1],
[1032062, 5, 1, 1],
[1122001, 25, 1, 1],
[1122002, 25, 1, 1],
[1122003, 25, 1, 1],
[1122004, 25, 1, 1],
[1122005, 25, 1, 1],
[1122006, 25, 1, 1],
[1122019, 5, 1, 1],
[1142230, 10, 1, 1],
[1142231, 10, 1, 1],
[1142232, 10, 1, 1],
[1142233, 10, 1, 1],
[1142234, 10, 1, 1],
[1142235, 10, 1, 1],
[1132133, 5, 1, 1],
[1132134, 1, 1, 1],
[1112598, 8, 1, 1],
[1112676, 25, 1, 1],
[1112677, 25, 1, 1],
[1112678, 5, 1, 1],
[1112679, 5, 1, 1],
[1052405, 5, 1, 1],
[2049118, 18, 1, 1],//混沌卷轴
[2340000, 18, 1, 1],//祝福卷轴
[1050018, 20, 1, 1],
[1050100, 20, 1, 1],
[1051098, 20, 1, 1],
[1050127, 5, 1, 1],
[1051140, 5, 1, 1],
[2070007, 1, 1, 1],//月牙镖
[2070006, 5, 1, 1],//齿轮镖
[2070005, 15, 1, 1],//金钱镖
[2070003, 18, 1, 1],//雪花标
[2070001, 18, 1, 1],//回旋镖
[2070008, 20, 1, 1],//小雪球镖
[1302142, 1, 1, 1],//黄金枫叶单手剑
[1312056, 1, 1, 1],
[1322084, 1, 1, 1],
[1332114, 1, 1, 1],
[1372071, 1, 1, 1],
[1382093, 1, 1, 1],
[1402085, 1, 1, 1],
[1412055, 1, 1, 1],
[1422057, 1, 1, 1],
[1432075, 1, 1, 1],
[1442104, 1, 1, 1],
[1452100, 1, 1, 1],
[1462085, 1, 1, 1],
[1472111, 1, 1, 1],
[1482073, 1, 1, 1],
[1112444, 8, 1, 1],
[1122075, 8, 1, 1],
[1302064, 8, 1, 1],
[1302145, 6, 1, 1],
[1312060, 6, 1, 1],
[1322088, 6, 1, 1],
[1332118, 6, 1, 1],
[1372076, 6, 1, 1],
[1382097, 6, 1, 1],
[1402088, 6, 1, 1],
[1412060, 6, 1, 1],
[1432079, 6, 1, 1],
[1442109, 6, 1, 1],
[1452104, 6, 1, 1],
[1462089, 6, 1, 1],
[1472115, 6, 1, 1],
[1492077, 6, 1, 1],
[1082343, 2, 1, 1],
[1082344, 2, 1, 1],
[1082345, 2, 1, 1],




];

var useNx = 1000;
var sel0 = -1;
function start() {
    status = -1;
    action(1, 0, 0);
}

function action(mode, type, selection) {
    if (status == 0 && mode == 0) {
        cm.dispose();
        return;
    }
    if (mode == 1) {
        status++;
    } else {
        status--;
    }

    if (status == 0) {
    	var txt = "#d              每抽一次奖多赠送一个黄金枫叶\r\n";
		txt += "#d     注:固有装备,每人只能一个,抽到已经有了不会给予\r\n";
    	txt += "#r#L1##b"+红色箭头+"点券抽奖#l\r\n\r\n";
		txt += "\t#b"+正方箭头+"奖品展示： \r\n";
		
		var txt2 = "";
		for (var i = 0; i < itemList1.length;  i++){
			txt2 += "#i"+itemList1[i][0]+":#";
		}
    	cm.sendSimple(txt + txt2);//可抽奖页面查看奖品
		cm.sendSimple(txt );
    } else if (status == 1) {
		var jobid=cm.getPlayer().getJob();
		//if (jobid==112||jobid==122||jobid==132||jobid==212||jobid==222||jobid==232||jobid==312||jobid==322||jobid==412||jobid==422||jobid==512||jobid==522||jobid==2112||jobid==1112||jobid==1111||jobid==1211||jobid==1311||jobid==1411||jobid==1511){
			
		sel0 = selection;
		cm.sendGetNumber("#d       请输入抽奖次数\r\n"
		+"#d       点卷抽奖10000点卷一次\r\n"
		//+"#r抽奖有保底，请看群文件"
		+"#r       当前拥有点卷数量"+点券图标+": "+cm.getPlayer().getCSPoints(1)+"#k\r\n#r " ,
		1, 1, 999);//设置次数999表示可以一次性抽999次
		//}else {
         //   cm.sendOk("您好，点卷抽奖需要您先完成所有转职后才可以进行抽奖哦！");
         //   cm.dispose();
          //  }
	} else if(status == 2) {
		if (!cm.checkNumSpace(0, selection)) {
			cm.sendOk("背包空间不足"+selection+"格");
			cm.dispose();
			return;
		}
    	switch (sel0) {
			case 1:
                if (cm.getPlayer().getCSPoints(1) < (useNx*selection)) {
					cm.sendOk("点卷不足"+(useNx*selection)+"，无法抽奖");
					cm.dispose();
					return;
				} else {
					cm.getPlayer().modifyCSPoints(1, -useNx*selection);
				}
				break;
			case 2:
                if (!cm.haveItem(4001126,400*selection)) {
					cm.sendOk("#v4001126#数量不足#r "+(400*selection)+" #k，无法抽奖");
					cm.dispose();
					return;
				} else {
					cm.gainItem(4001126, -(400*selection));
				}
				break;
			default:
				cm.sendOk("脚本出错，请联系管理员");
				cm.dispose();
				return;
        }
		var txt = "恭喜你获得道具：\r\n";
		for (var i = 0; i < selection; i++) {
			var item;
			var ran = Math.floor(Math.random() * 100);
			var ran1 = null;
			ran1 = finalGift(itemList1);
			if(cm.getBossRankCount("屏蔽"+ran1[0]) > 0){
				cm.gainGachaponItem2(4001126, 1, "抽奖机", ran1[3]);
			}else{
				cm.gainGachaponItem3(ran1[0], ran1[2], "抽奖机", 1);//1绿色  2黄色  3不广告
			}
			cm.gainItem(4000313, 1);
			//cm.gainItem(ran1[0] ,ran1[2])
			
			txt += "#v" + ran1[0] + "#\r\n";
			var result = cm.setBossRankCount("随机奖池抽奖");
			/*
			var ran2 = null;
			if (result%10 == 0) {//十连抽保底
				ran2 = finalGift(itemList1);
				cm.gainItem(ran2[0] ,ran2[2])
				txt += "额外道具：#v" + ran2[0] + "#\r\n";
			}
			*/
		}
		cm.sendOk(txt);
		cm.dispose();
		return;
    }
}

function finalGift(lists) {
	var maxChance = 0;
	for (var i in lists) {
		if (lists[i][1] > maxChance) {
			maxChance = lists[i][1];
		}
	}
	var chance = Math.floor(Math.random() * maxChance);
	var finalitem = Array();
	for (var i = 0; i < lists.length; i++) {
		if (lists[i][1] >= chance) {
			finalitem.push(lists[i]);
		}
	}
	var ran1 = Math.floor(Math.random() * finalitem.length);
	return finalitem[ran1];
}